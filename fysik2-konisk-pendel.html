<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konisk pendel - Fysiklabbet</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <style>
        #canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        #canvas-container canvas {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">⚛️</span>
                <span class="logo-text">Fysiklabbet</span>
            </a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Hem</a></li>
                <li><a href="fysik1.html" class="nav-link">Fysik 1</a></li>
                <li><a href="fysik2.html" class="nav-link active">Fysik 2</a></li>
            </ul>
        </div>
    </nav>

    <main class="min-h-screen w-full bg-gray-100 text-gray-800 flex flex-col lg:flex-row">
        <div id="canvas-container" class="flex-grow h-[50vh] lg:h-screen w-full lg:w-2/3 relative bg-white">
            <div class="absolute top-4 left-4 text-gray-900 p-2 rounded-lg z-10">
                <h1 class="text-2xl md:text-4xl font-bold tracking-tighter">Konisk pendel</h1>
            </div>
        </div>
        <div class="w-full lg:w-1/3 bg-white/60 backdrop-blur-md p-6 md:p-8 flex flex-col space-y-8 overflow-y-auto" id="controls-container">
        </div>
    </main>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // State
        let params = {
            length: 2.0,        // Snörets längd (m)
            mass: 0.5,          // Kulans massa (kg)
            angle: 30,          // Vinkel från vertikalen (grader)
            gravity: 9.81,      // Tyngdfaktor (m/s²)
        };

        let simulationState = 'idle'; // 'idle', 'running'
        let currentRotation = 0;      // Nuvarande rotationsvinkel (radianer)
        let time = 0;

        // Three.js setup
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);

        const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.set(5, 3, 5);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.target.set(0, 0, 0);

        // Lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
        directionalLight.position.set(8, 10, 5);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        directionalLight.shadow.camera.left = -5;
        directionalLight.shadow.camera.right = 5;
        directionalLight.shadow.camera.top = 5;
        directionalLight.shadow.camera.bottom = -5;
        scene.add(directionalLight);

        // Floor
        const floorGeometry = new THREE.PlaneGeometry(20, 20);
        const floorMaterial = new THREE.MeshStandardMaterial({ color: 0xC4A484 });
        const floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.rotation.x = -Math.PI / 2;
        floor.position.y = -0.5;
        floor.receiveShadow = true;
        scene.add(floor);

        // Pivot point (at ceiling)
        const pivotHeight = 3.0;
        const pivotGeometry = new THREE.SphereGeometry(0.08, 16, 16);
        const pivotMaterial = new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.8, roughness: 0.2 });
        const pivot = new THREE.Mesh(pivotGeometry, pivotMaterial);
        pivot.position.set(0, pivotHeight, 0);
        pivot.castShadow = true;
        scene.add(pivot);

        // Ceiling rod (kort stång i taket)
        const ceilingRodGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.3, 16);
        const ceilingRodMaterial = new THREE.MeshStandardMaterial({ color: 0x888888, metalness: 0.6, roughness: 0.3 });
        const ceilingRod = new THREE.Mesh(ceilingRodGeometry, ceilingRodMaterial);
        ceilingRod.position.set(0, pivotHeight + 0.15, 0);
        ceilingRod.castShadow = true;
        scene.add(ceilingRod);

        // Pendulum group (rotates around Y axis)
        const pendulumGroup = new THREE.Group();
        scene.add(pendulumGroup);

        // String
        let stringMesh;
        function createString() {
            if (stringMesh) {
                pendulumGroup.remove(stringMesh);
            }
            const angleRad = (params.angle * Math.PI) / 180;
            const stringGeometry = new THREE.CylinderGeometry(0.015, 0.015, params.length, 8);
            const stringMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
            stringMesh = new THREE.Mesh(stringGeometry, stringMaterial);

            // Position string so it starts at pivot and goes down at an angle
            stringMesh.position.set(
                params.length * Math.sin(angleRad) / 2,
                pivotHeight - params.length * Math.cos(angleRad) / 2,
                0
            );
            stringMesh.rotation.z = angleRad;
            pendulumGroup.add(stringMesh);
        }

        // Bob (ball)
        let bobMesh;
        function createBob() {
            if (bobMesh) {
                pendulumGroup.remove(bobMesh);
            }
            const angleRad = (params.angle * Math.PI) / 180;
            const bobRadius = 0.15 + params.mass * 0.1;
            const bobGeometry = new THREE.SphereGeometry(bobRadius, 32, 32);
            const bobMaterial = new THREE.MeshStandardMaterial({
                color: 0x3b82f6,
                metalness: 0.3,
                roughness: 0.6
            });
            bobMesh = new THREE.Mesh(bobGeometry, bobMaterial);
            bobMesh.position.set(
                params.length * Math.sin(angleRad),
                pivotHeight - params.length * Math.cos(angleRad),
                0
            );
            bobMesh.castShadow = true;
            pendulumGroup.add(bobMesh);
        }

        // Circular path indicator (dashed circle)
        let circleHelper;
        function createCircleHelper() {
            if (circleHelper) {
                scene.remove(circleHelper);
            }
            const angleRad = (params.angle * Math.PI) / 180;
            const radius = params.length * Math.sin(angleRad);
            const circleY = pivotHeight - params.length * Math.cos(angleRad);

            const circleGeometry = new THREE.BufferGeometry().setFromPoints(
                new THREE.Path().absarc(0, 0, radius, 0, Math.PI * 2, false).getPoints(64)
            );
            const circleMaterial = new THREE.LineDashedMaterial({
                color: 0x999999,
                dashSize: 0.1,
                gapSize: 0.05
            });
            circleHelper = new THREE.Line(circleGeometry, circleMaterial);
            circleHelper.computeLineDistances();
            circleHelper.rotation.x = Math.PI / 2;
            circleHelper.position.y = circleY;
            scene.add(circleHelper);
        }

        // Force vectors
        let forceVectors = {
            gravity: null,
            tension: null,
            centripetal: null,
            tensionVertical: null,
            tensionHorizontal: null,
        };

        let showForces = {
            gravity: true,
            tension: true,
            centripetal: false,
            components: false,
        };

        function createArrow(color, scale = 1) {
            const dir = new THREE.Vector3(0, 1, 0);
            const origin = new THREE.Vector3(0, 0, 0);
            const length = 1 * scale;
            const hex = color;
            return new THREE.ArrowHelper(dir, origin, length, hex, 0.2 * scale, 0.15 * scale);
        }

        function updateForceVectors() {
            // Remove old vectors
            Object.values(forceVectors).forEach(vec => {
                if (vec) scene.remove(vec);
            });

            const angleRad = (params.angle * Math.PI) / 180;
            const bobX = params.length * Math.sin(angleRad);
            const bobY = pivotHeight - params.length * Math.cos(angleRad);
            const bobPos = new THREE.Vector3(bobX * Math.cos(currentRotation), bobY, bobX * Math.sin(currentRotation));

            const forceScale = 0.5;

            // Gravity force (downward)
            if (showForces.gravity) {
                const gravityMag = params.mass * params.gravity;
                const gravityDir = new THREE.Vector3(0, -1, 0);
                forceVectors.gravity = createArrow(0xff0000, forceScale);
                forceVectors.gravity.position.copy(bobPos);
                forceVectors.gravity.setDirection(gravityDir);
                forceVectors.gravity.setLength(gravityMag * forceScale);
                scene.add(forceVectors.gravity);
            }

            // Tension force (along string toward pivot)
            if (showForces.tension) {
                const tensionMag = (params.mass * params.gravity) / Math.cos(angleRad);
                const tensionDir = new THREE.Vector3(
                    -bobX * Math.cos(currentRotation),
                    params.length * Math.cos(angleRad),
                    -bobX * Math.sin(currentRotation)
                ).normalize();
                forceVectors.tension = createArrow(0x00ff00, forceScale);
                forceVectors.tension.position.copy(bobPos);
                forceVectors.tension.setDirection(tensionDir);
                forceVectors.tension.setLength(tensionMag * forceScale);
                scene.add(forceVectors.tension);
            }

            // Centripetal force (horizontal, toward center)
            if (showForces.centripetal) {
                const radius = params.length * Math.sin(angleRad);
                const omega = Math.sqrt(params.gravity / (params.length * Math.cos(angleRad)));
                const centripetalMag = params.mass * omega * omega * radius;
                const centripetalDir = new THREE.Vector3(
                    -Math.cos(currentRotation),
                    0,
                    -Math.sin(currentRotation)
                );
                forceVectors.centripetal = createArrow(0x0000ff, forceScale);
                forceVectors.centripetal.position.copy(bobPos);
                forceVectors.centripetal.setDirection(centripetalDir);
                forceVectors.centripetal.setLength(centripetalMag * forceScale);
                scene.add(forceVectors.centripetal);
            }

            // Tension components
            if (showForces.components && showForces.tension) {
                const tensionMag = (params.mass * params.gravity) / Math.cos(angleRad);

                // Vertical component
                const tensionVerticalMag = tensionMag * Math.cos(angleRad);
                const tensionVerticalDir = new THREE.Vector3(0, 1, 0);
                forceVectors.tensionVertical = createArrow(0x00cc00, forceScale * 0.8);
                forceVectors.tensionVertical.position.copy(bobPos);
                forceVectors.tensionVertical.setDirection(tensionVerticalDir);
                forceVectors.tensionVertical.setLength(tensionVerticalMag * forceScale);
                scene.add(forceVectors.tensionVertical);

                // Horizontal component
                const tensionHorizontalMag = tensionMag * Math.sin(angleRad);
                const tensionHorizontalDir = new THREE.Vector3(
                    -Math.cos(currentRotation),
                    0,
                    -Math.sin(currentRotation)
                );
                forceVectors.tensionHorizontal = createArrow(0xcccc00, forceScale * 0.8);
                forceVectors.tensionHorizontal.position.copy(bobPos);
                forceVectors.tensionHorizontal.setDirection(tensionHorizontalDir);
                forceVectors.tensionHorizontal.setLength(tensionHorizontalMag * forceScale);
                scene.add(forceVectors.tensionHorizontal);
            }
        }

        // Angle indicator (arc from vertical to string)
        let angleArc;
        function createAngleIndicator() {
            if (angleArc) {
                scene.remove(angleArc);
            }
            const angleRad = (params.angle * Math.PI) / 180;
            const arcRadius = 0.5;
            const arcCurve = new THREE.EllipseCurve(
                0, 0,
                arcRadius, arcRadius,
                0, angleRad,
                false, 0
            );
            const arcPoints = arcCurve.getPoints(32);
            const arcGeometry = new THREE.BufferGeometry().setFromPoints(arcPoints);
            const arcMaterial = new THREE.LineBasicMaterial({ color: 0xff6600, linewidth: 2 });
            angleArc = new THREE.Line(arcGeometry, arcMaterial);
            angleArc.rotation.y = -Math.PI / 2 - currentRotation;
            angleArc.rotation.z = Math.PI / 2;
            angleArc.position.set(0, pivotHeight, 0);
            scene.add(angleArc);
        }

        // Initialize geometry
        createString();
        createBob();
        createCircleHelper();
        createAngleIndicator();
        updateForceVectors();

        // Animation
        function animate() {
            requestAnimationFrame(animate);

            if (simulationState === 'running') {
                const angleRad = (params.angle * Math.PI) / 180;
                const omega = Math.sqrt(params.gravity / (params.length * Math.cos(angleRad)));

                const delta = 1 / 60;
                time += delta;
                currentRotation = omega * time;

                pendulumGroup.rotation.y = currentRotation;

                if (angleArc) {
                    angleArc.rotation.y = -Math.PI / 2 - currentRotation;
                }

                updateForceVectors();
            }

            controls.update();
            renderer.render(scene, camera);
        }

        animate();

        // Window resize
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });

        // Calculate physics values
        function getPhysicsValues() {
            const angleRad = (params.angle * Math.PI) / 180;
            const radius = params.length * Math.sin(angleRad);
            const height = params.length * Math.cos(angleRad);
            const omega = Math.sqrt(params.gravity / height);
            const period = 2 * Math.PI / omega;
            const velocity = omega * radius;
            const tension = (params.mass * params.gravity) / Math.cos(angleRad);
            const centripetal = params.mass * omega * omega * radius;

            return {
                radius: radius.toFixed(3),
                height: height.toFixed(3),
                omega: omega.toFixed(3),
                period: period.toFixed(3),
                velocity: velocity.toFixed(3),
                tension: tension.toFixed(2),
                centripetal: centripetal.toFixed(2),
                gravity: (params.mass * params.gravity).toFixed(2),
            };
        }

        // Controls UI
        function updateControls() {
            const isIdle = simulationState === 'idle';
            const physics = getPhysicsValues();

            const controlsHTML = `
                <div class="space-y-6">
                    <h2 class="text-xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2">Kontrollpanel</h2>

                    <div class="w-full">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-sm font-medium ${isIdle ? 'text-gray-700' : 'text-gray-400'}">Snörets längd (L)</label>
                            <span class="text-sm font-mono px-2 py-0.5 rounded font-semibold ${isIdle ? 'bg-blue-100 text-blue-700' : 'bg-gray-200 text-gray-500'}">
                                ${params.length.toFixed(2).replace('.', ',')} m
                            </span>
                        </div>
                        <input id="length-slider" type="range" min="0.5" max="4" step="0.1" value="${params.length}" ${!isIdle ? 'disabled' : ''}
                            class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer range-lg accent-blue-500 disabled:accent-gray-400 disabled:bg-gray-200 disabled:cursor-not-allowed">
                    </div>

                    <div class="w-full">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-sm font-medium ${isIdle ? 'text-gray-700' : 'text-gray-400'}">Massa (m)</label>
                            <span class="text-sm font-mono px-2 py-0.5 rounded font-semibold ${isIdle ? 'bg-blue-100 text-blue-700' : 'bg-gray-200 text-gray-500'}">
                                ${params.mass.toFixed(2).replace('.', ',')} kg
                            </span>
                        </div>
                        <input id="mass-slider" type="range" min="0.1" max="2" step="0.1" value="${params.mass}" ${!isIdle ? 'disabled' : ''}
                            class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer range-lg accent-blue-500 disabled:accent-gray-400 disabled:bg-gray-200 disabled:cursor-not-allowed">
                    </div>

                    <div class="w-full">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-sm font-medium ${isIdle ? 'text-gray-700' : 'text-gray-400'}">Vinkel (θ)</label>
                            <span class="text-sm font-mono px-2 py-0.5 rounded font-semibold ${isIdle ? 'bg-blue-100 text-blue-700' : 'bg-gray-200 text-gray-500'}">
                                ${params.angle.toFixed(1).replace('.', ',')}°
                            </span>
                        </div>
                        <input id="angle-slider" type="range" min="5" max="75" step="1" value="${params.angle}" ${!isIdle ? 'disabled' : ''}
                            class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer range-lg accent-blue-500 disabled:accent-gray-400 disabled:bg-gray-200 disabled:cursor-not-allowed">
                    </div>

                    <div class="w-full">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-sm font-medium ${isIdle ? 'text-gray-700' : 'text-gray-400'}">Tyngdfaktor (g)</label>
                            <span class="text-sm font-mono px-2 py-0.5 rounded font-semibold ${isIdle ? 'bg-blue-100 text-blue-700' : 'bg-gray-200 text-gray-500'}">
                                ${params.gravity.toFixed(2).replace('.', ',')} m/s²
                            </span>
                        </div>
                        <input id="gravity-slider" type="range" min="1" max="25" step="0.1" value="${params.gravity}" ${!isIdle ? 'disabled' : ''}
                            class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer range-lg accent-blue-500 disabled:accent-gray-400 disabled:bg-gray-200 disabled:cursor-not-allowed">
                    </div>

                    <div class="space-y-3 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                        <h3 class="text-md font-semibold text-gray-800">Visa krafter</h3>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="show-gravity" ${showForces.gravity ? 'checked' : ''} class="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                            <span class="text-sm text-gray-700">Tyngdkraft (F<sub>g</sub>) - <span class="text-red-600">röd</span></span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="show-tension" ${showForces.tension ? 'checked' : ''} class="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                            <span class="text-sm text-gray-700">Spännkraft (F<sub>T</sub>) - <span class="text-green-600">grön</span></span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="show-centripetal" ${showForces.centripetal ? 'checked' : ''} class="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                            <span class="text-sm text-gray-700">Centripetalkraft (F<sub>c</sub>) - <span class="text-blue-600">blå</span></span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="show-components" ${showForces.components ? 'checked' : ''} class="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                            <span class="text-sm text-gray-700">Visa komponenter av spännkraft</span>
                        </label>
                    </div>

                    <div class="flex items-center justify-center space-x-4 pt-4">
                        <button id="start-button" ${!isIdle ? 'disabled' : ''}
                            class="px-6 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 w-32 disabled:bg-blue-300 disabled:cursor-not-allowed">
                            ${isIdle ? 'Starta' : 'Kör...'}
                        </button>
                        <button id="stop-button" ${isIdle ? 'disabled' : ''}
                            class="px-6 py-2 font-semibold text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 w-32 disabled:bg-gray-300 disabled:cursor-not-allowed">
                            Stoppa
                        </button>
                    </div>
                </div>

                <div class="space-y-4 p-6 bg-white/50 rounded-lg border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2">Fysikaliska värden</h2>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <p class="text-xs text-gray-600">Radie (r)</p>
                            <p class="text-lg font-mono font-bold text-blue-700">${physics.radius.replace('.', ',')} m</p>
                        </div>
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <p class="text-xs text-gray-600">Höjd (h)</p>
                            <p class="text-lg font-mono font-bold text-blue-700">${physics.height.replace('.', ',')} m</p>
                        </div>
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <p class="text-xs text-gray-600">Vinkelhastighet (ω)</p>
                            <p class="text-lg font-mono font-bold text-green-700">${physics.omega.replace('.', ',')} rad/s</p>
                        </div>
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <p class="text-xs text-gray-600">Period (T)</p>
                            <p class="text-lg font-mono font-bold text-green-700">${physics.period.replace('.', ',')} s</p>
                        </div>
                        <div class="text-center p-3 bg-purple-50 rounded-lg">
                            <p class="text-xs text-gray-600">Hastighet (v)</p>
                            <p class="text-lg font-mono font-bold text-purple-700">${physics.velocity.replace('.', ',')} m/s</p>
                        </div>
                        <div class="text-center p-3 bg-purple-50 rounded-lg">
                            <p class="text-xs text-gray-600">F<sub>g</sub> (Tyngdkraft)</p>
                            <p class="text-lg font-mono font-bold text-red-700">${physics.gravity.replace('.', ',')} N</p>
                        </div>
                        <div class="text-center p-3 bg-orange-50 rounded-lg">
                            <p class="text-xs text-gray-600">F<sub>T</sub> (Spännkraft)</p>
                            <p class="text-lg font-mono font-bold text-green-700">${physics.tension.replace('.', ',')} N</p>
                        </div>
                        <div class="text-center p-3 bg-orange-50 rounded-lg">
                            <p class="text-xs text-gray-600">F<sub>c</sub> (Centripetal)</p>
                            <p class="text-lg font-mono font-bold text-blue-700">${physics.centripetal.replace('.', ',')} N</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4 p-6 bg-white/50 rounded-lg border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2">Information</h2>
                    <div class="text-sm text-gray-700 leading-relaxed space-y-2">
                        <p>
                            <strong class="text-blue-600">Konisk pendel:</strong> En kula som hänger i ett snöre och roterar i en cirkulär bana. Snöret bildar en kon.
                        </p>
                        <p>
                            <strong class="text-green-600">Krafter:</strong> Tyngdkraften (F<sub>g</sub>) drar nedåt. Spännkraften (F<sub>T</sub>) drar längs snöret mot upphängningspunkten. Den horisontella komponenten av spännkraften ger centripetalkraften (F<sub>c</sub>).
                        </p>
                        <p>
                            <strong class="text-purple-600">Formler:</strong><br>
                            • ω = √(g / (L·cos θ))<br>
                            • T = 2π / ω<br>
                            • v = ω · r<br>
                            • F<sub>T</sub> = mg / cos θ<br>
                            • F<sub>c</sub> = mω²r
                        </p>
                        <p class="text-xs text-gray-600 italic">
                            Rotera kameran med musen för att se från olika perspektiv!
                        </p>
                    </div>
                </div>
            `;

            document.getElementById('controls-container').innerHTML = controlsHTML;

            // Attach event listeners
            const lengthSlider = document.getElementById('length-slider');
            const massSlider = document.getElementById('mass-slider');
            const angleSlider = document.getElementById('angle-slider');
            const gravitySlider = document.getElementById('gravity-slider');
            const startButton = document.getElementById('start-button');
            const stopButton = document.getElementById('stop-button');

            const showGravityCheckbox = document.getElementById('show-gravity');
            const showTensionCheckbox = document.getElementById('show-tension');
            const showCentripetalCheckbox = document.getElementById('show-centripetal');
            const showComponentsCheckbox = document.getElementById('show-components');

            if (lengthSlider) lengthSlider.addEventListener('input', (e) => {
                params.length = parseFloat(e.target.value);
                createString();
                createBob();
                createCircleHelper();
                createAngleIndicator();
                updateForceVectors();
                updateControls();
            });

            if (massSlider) massSlider.addEventListener('input', (e) => {
                params.mass = parseFloat(e.target.value);
                createBob();
                updateForceVectors();
                updateControls();
            });

            if (angleSlider) angleSlider.addEventListener('input', (e) => {
                params.angle = parseFloat(e.target.value);
                createString();
                createBob();
                createCircleHelper();
                createAngleIndicator();
                updateForceVectors();
                updateControls();
            });

            if (gravitySlider) gravitySlider.addEventListener('input', (e) => {
                params.gravity = parseFloat(e.target.value);
                updateForceVectors();
                updateControls();
            });

            if (startButton) startButton.addEventListener('click', () => {
                simulationState = 'running';
                time = 0;
                currentRotation = 0;
                updateControls();
            });

            if (stopButton) stopButton.addEventListener('click', () => {
                simulationState = 'idle';
                updateControls();
            });

            if (showGravityCheckbox) showGravityCheckbox.addEventListener('change', (e) => {
                showForces.gravity = e.target.checked;
                updateForceVectors();
            });

            if (showTensionCheckbox) showTensionCheckbox.addEventListener('change', (e) => {
                showForces.tension = e.target.checked;
                updateForceVectors();
            });

            if (showCentripetalCheckbox) showCentripetalCheckbox.addEventListener('change', (e) => {
                showForces.centripetal = e.target.checked;
                updateForceVectors();
            });

            if (showComponentsCheckbox) showComponentsCheckbox.addEventListener('change', (e) => {
                showForces.components = e.target.checked;
                updateForceVectors();
            });
        }

        updateControls();
    </script>
</body>
</html>
