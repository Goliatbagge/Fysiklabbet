<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tyngdfaktorn på jorden - Fysiklabbet</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow-x: hidden;
            font-family: 'Poppins', sans-serif;
        }

        #canvas-container {
            width: 100%;
            height: 600px;
            position: relative;
            background: linear-gradient(to bottom, #000428, #004e92);
            border-radius: 12px;
            overflow: hidden;
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 189, 248, 0.15);
        }

        .glow-text {
            text-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
        }

        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.88);
            backdrop-filter: blur(14px);
            border: 1px solid rgba(56, 189, 248, 0.2);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5), 0 0 20px rgba(56, 189, 248, 0.08);
            min-width: 210px;
        }

        .instruction-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(14px);
            border: 1px solid rgba(56, 189, 248, 0.15);
            padding: 15px 18px;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
            max-width: 300px;
        }

        .panel-divider {
            border: none;
            border-top: 1px solid rgba(56, 189, 248, 0.15);
            margin: 12px 0;
        }

        /* Custom checkbox */
        .dark-checkbox {
            appearance: none;
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border: 1.5px solid rgba(56, 189, 248, 0.4);
            border-radius: 4px;
            background: rgba(15, 23, 42, 0.8);
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .dark-checkbox:checked {
            background: rgba(56, 189, 248, 0.25);
            border-color: rgba(56, 189, 248, 0.8);
        }

        .dark-checkbox:checked::after {
            content: '';
            position: absolute;
            left: 4px;
            top: 1px;
            width: 5px;
            height: 9px;
            border: 2px solid #38bdf8;
            border-top: none;
            border-left: none;
            transform: rotate(45deg);
        }

        .dark-checkbox:hover {
            border-color: rgba(56, 189, 248, 0.7);
        }

        canvas {
            cursor: grab;
        }

        canvas:active {
            cursor: grabbing;
        }

        @media (max-width: 768px) {
            #canvas-container {
                height: 420px;
            }
            .info-panel {
                top: 10px;
                right: 10px;
                min-width: 170px;
                padding: 14px;
            }
            .instruction-panel {
                bottom: 10px;
                left: 10px;
                max-width: 220px;
                padding: 12px;
            }
        }
    </style>
</head>
<body class="bg-slate-950">
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">⚛️</span>
                <span class="logo-text">Fysiklabbet</span>
            </a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Hem</a></li>
                <li><a href="fysik1.html" class="nav-link active">Fysik 1</a></li>
                <li><a href="fysik2.html" class="nav-link">Fysik 2</a></li>
                <li><a href="om.html" class="nav-link">Om</a></li>
                <li><a href="kontakt.html" class="nav-link">Kontakt</a></li>
            </ul>
        </div>
    </nav>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function GravitySimulation() {
            const containerRef = useRef(null);
            const [clickedPoint, setClickedPoint] = useState(null);
            const [gravity, setGravity] = useState(null);
            const [showEquator, setShowEquator] = useState(true);
            const [showPoles, setShowPoles] = useState(true);
            const sceneRef = useRef(null);
            const equatorLineRef = useRef(null);
            const polesRef = useRef(null);

            useEffect(() => {
                if (!containerRef.current) return;

                // Wait for DOM to be fully rendered
                requestAnimationFrame(() => {
                    if (!containerRef.current) return;

                    // Scene setup
                    const scene = new THREE.Scene();
                    sceneRef.current = scene;

                    const camera = new THREE.PerspectiveCamera(
                        75,
                        containerRef.current.clientWidth / containerRef.current.clientHeight,
                        0.1,
                        1000
                    );
                    camera.position.set(0, 0, 1.9);
                    camera.lookAt(0, 0, 0);

                    const renderer = new THREE.WebGLRenderer({ antialias: true });
                    renderer.setSize(containerRef.current.clientWidth, containerRef.current.clientHeight);
                    containerRef.current.appendChild(renderer.domElement);

                    // Add stars
                    const starsGeometry = new THREE.BufferGeometry();
                    const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.02 });
                    const starsVertices = [];
                    for (let i = 0; i < 1000; i++) {
                        const x = (Math.random() - 0.5) * 50;
                        const y = (Math.random() - 0.5) * 50;
                        const z = (Math.random() - 0.5) * 50;
                        starsVertices.push(x, y, z);
                    }
                    starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
                    const stars = new THREE.Points(starsGeometry, starsMaterial);
                    scene.add(stars);

                    // Earth sphere
                    const geometry = new THREE.SphereGeometry(1, 64, 64);

                    // Create texture loader
                    const textureLoader = new THREE.TextureLoader();

                    // Load Earth texture
                    const earthTexture = textureLoader.load(
                        'https://unpkg.com/three-globe@2.24.9/example/img/earth-blue-marble.jpg',
                        () => {
                            renderer.render(scene, camera);
                        }
                    );

                    const material = new THREE.MeshPhongMaterial({
                        map: earthTexture,
                        shininess: 5
                    });

                    const earth = new THREE.Mesh(geometry, material);
                    earth.position.set(0, 0, 0);
                    // Rotate to show Europe/Africa in center
                    earth.rotation.y = Math.PI;

                    // Equator line (add to earth before adding earth to scene)
                    const equatorPoints = [];
                    const equatorSegments = 128;
                    const equatorRadius = 1.01; // Slightly larger than Earth radius
                    for (let i = 0; i <= equatorSegments; i++) {
                        const angle = (i / equatorSegments) * Math.PI * 2;
                        equatorPoints.push(new THREE.Vector3(
                            Math.cos(angle) * equatorRadius,
                            0,
                            Math.sin(angle) * equatorRadius
                        ));
                    }
                    const equatorGeometry = new THREE.BufferGeometry().setFromPoints(equatorPoints);
                    const equatorMaterial = new THREE.LineBasicMaterial({
                        color: 0xffff00,
                        linewidth: 2,
                        transparent: true,
                        opacity: 0.8
                    });
                    const equatorLine = new THREE.LineLoop(equatorGeometry, equatorMaterial);
                    equatorLineRef.current = equatorLine;
                    earth.add(equatorLine); // Add to earth instead of scene

                    // Pole markers
                    const polesGroup = new THREE.Group();

                    // North pole marker (flat disc)
                    const poleGeometry = new THREE.CircleGeometry(0.06, 32);
                    const poleMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00, side: THREE.DoubleSide });
                    const northPole = new THREE.Mesh(poleGeometry, poleMaterial);
                    northPole.position.set(0, 1.01, 0);
                    northPole.rotation.x = -Math.PI / 2;
                    polesGroup.add(northPole);

                    // South pole marker (flat disc)
                    const southPole = new THREE.Mesh(poleGeometry, poleMaterial);
                    southPole.position.set(0, -1.01, 0);
                    southPole.rotation.x = Math.PI / 2;
                    polesGroup.add(southPole);

                    polesRef.current = polesGroup;
                    earth.add(polesGroup);

                    scene.add(earth);

                    // Lighting
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
                    scene.add(ambientLight);

                    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    directionalLight.position.set(5, 3, 5);
                    scene.add(directionalLight);

                    // Marker for clicked point
                    let marker = null;

                    // Mouse controls
                    let isDragging = false;
                    let hasDragged = false;
                    let previousMousePosition = { x: 0, y: 0 };

                    const onMouseDown = (e) => {
                        isDragging = true;
                        hasDragged = false;
                        previousMousePosition = { x: e.clientX, y: e.clientY };
                    };

                    const onMouseMove = (e) => {
                        if (isDragging) {
                            const deltaX = e.clientX - previousMousePosition.x;
                            const deltaY = e.clientY - previousMousePosition.y;

                            if (Math.abs(deltaX) > 2 || Math.abs(deltaY) > 2) {
                                hasDragged = true;
                            }

                            earth.rotation.y += deltaX * 0.005;
                            earth.rotation.x += deltaY * 0.005;

                            previousMousePosition = { x: e.clientX, y: e.clientY };
                        }
                    };

                    const onMouseUp = () => {
                        isDragging = false;
                    };

                    const onWheel = (e) => {
                        e.preventDefault();

                        // Zoom in/out by adjusting camera position
                        const zoomSpeed = 0.1;
                        const delta = e.deltaY > 0 ? 1 : -1;

                        camera.position.z += delta * zoomSpeed;

                        // Limit zoom range (min 1.5, max 5)
                        camera.position.z = Math.max(1.5, Math.min(5, camera.position.z));
                    };

                    const onClick = (e) => {
                        if (hasDragged) return;

                        const rect = renderer.domElement.getBoundingClientRect();
                        const mouse = new THREE.Vector2();
                        mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
                        mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

                        const raycaster = new THREE.Raycaster();
                        raycaster.setFromCamera(mouse, camera);

                        const intersects = raycaster.intersectObject(earth);

                        if (intersects.length > 0) {
                            const point = intersects[0].point;

                            // Convert world coordinates to earth's local coordinates
                            const localPoint = earth.worldToLocal(point.clone());

                            // Calculate latitude from the local point
                            const radius = 1;
                            const latitude = Math.asin(localPoint.y / radius) * (180 / Math.PI);

                            // Calculate gravity based on latitude
                            // Formula: g = 9.78 + 0.05 * sin²(φ)
                            // Equator (0°): 9.78 m/s², Poles (±90°): 9.83 m/s²
                            const latRad = latitude * (Math.PI / 180);
                            const g = 9.78 + 0.05 * Math.pow(Math.sin(latRad), 2);

                            setGravity(g.toFixed(2).replace('.', ','));
                            setClickedPoint({
                                latitude: latitude.toFixed(1).replace('.', ','),
                                longitude: (Math.atan2(localPoint.x, localPoint.z) * (180 / Math.PI)).toFixed(1).replace('.', ',')
                            });

                            // Remove old marker
                            if (marker) {
                                earth.remove(marker);
                            }

                            // Add new marker (yellow X-cross using boxes)
                            const markerGroup = new THREE.Group();
                            const markerMaterial = new THREE.MeshBasicMaterial({ color: 0xff66ff });
                            const markerSize = 0.045;
                            const thickness = 0.01;

                            // First diagonal bar
                            const bar1Geometry = new THREE.BoxGeometry(markerSize, thickness, thickness);
                            const bar1 = new THREE.Mesh(bar1Geometry, markerMaterial);
                            bar1.rotation.z = Math.PI / 4; // 45 degrees
                            markerGroup.add(bar1);

                            // Second diagonal bar
                            const bar2Geometry = new THREE.BoxGeometry(markerSize, thickness, thickness);
                            const bar2 = new THREE.Mesh(bar2Geometry, markerMaterial);
                            bar2.rotation.z = -Math.PI / 4; // -45 degrees
                            markerGroup.add(bar2);

                            // Position marker in earth's local space, slightly above surface
                            const surfacePoint = localPoint.clone().normalize().multiplyScalar(1.02);
                            markerGroup.position.copy(surfacePoint);
                            // Orient the marker to face outward from the earth surface
                            markerGroup.lookAt(surfacePoint.clone().multiplyScalar(2));

                            marker = markerGroup;
                            earth.add(marker);
                        }
                    };

                    renderer.domElement.addEventListener('mousedown', onMouseDown);
                    renderer.domElement.addEventListener('mousemove', onMouseMove);
                    renderer.domElement.addEventListener('mouseup', onMouseUp);
                    renderer.domElement.addEventListener('click', onClick);
                    renderer.domElement.addEventListener('wheel', onWheel);

                    // Animation loop
                    const animate = () => {
                        requestAnimationFrame(animate);
                        renderer.render(scene, camera);
                    };
                    animate();

                    // Handle resize
                    const handleResize = () => {
                        camera.aspect = containerRef.current.clientWidth / containerRef.current.clientHeight;
                        camera.updateProjectionMatrix();
                        renderer.setSize(containerRef.current.clientWidth, containerRef.current.clientHeight);
                    };
                    window.addEventListener('resize', handleResize);

                    // Cleanup
                    return () => {
                        window.removeEventListener('resize', handleResize);
                        renderer.domElement.removeEventListener('mousedown', onMouseDown);
                        renderer.domElement.removeEventListener('mousemove', onMouseMove);
                        renderer.domElement.removeEventListener('mouseup', onMouseUp);
                        renderer.domElement.removeEventListener('click', onClick);
                        renderer.domElement.removeEventListener('wheel', onWheel);
                        containerRef.current?.removeChild(renderer.domElement);
                    };
                });
            }, []);

            // Toggle equator visibility
            useEffect(() => {
                if (equatorLineRef.current) {
                    equatorLineRef.current.visible = showEquator;
                }
            }, [showEquator]);

            // Toggle poles visibility
            useEffect(() => {
                if (polesRef.current) {
                    polesRef.current.visible = showPoles;
                }
            }, [showPoles]);

            return (
                <div
                    className="min-h-screen"
                    style={{
                        background: 'linear-gradient(135deg, #0a0a1a 0%, #0d1526 50%, #0a1020 100%)',
                        fontFamily: 'Poppins, sans-serif',
                        paddingBottom: '0'
                    }}
                >
                    <div className="max-w-6xl mx-auto px-4 md:px-8" style={{ paddingTop: '2rem' }}>

                        {/* Breadcrumb */}
                        <div className="breadcrumb mb-6">
                            <a href="index.html">Hem</a> / <a href="fysik1.html">Fysik 1</a> / Tyngdfaktorn på jorden
                        </div>

                        {/* Header */}
                        <div
                            className="rounded-2xl p-6 md:p-8 mb-8 glass-card"
                        >
                            <h1
                                className="font-black tracking-tight glow-text mb-3"
                                style={{
                                    fontSize: 'clamp(1.8rem, 4vw, 2.8rem)',
                                    color: '#e2e8f0'
                                }}
                            >
                                Tyngdfaktorn på jorden
                            </h1>
                            <p style={{ color: '#94a3b8', fontSize: '1.05rem', lineHeight: '1.7' }}>
                                Tyngdaccelerationen (<em>g</em>) varierar på jorden beroende på var du befinner dig.
                                Vid ekvatorn är den lägst (cirka 9,78 m/s²) och vid polerna högst (cirka 9,83 m/s²).
                                Detta beror på jordens rotation och att jorden är något tillplattad vid polerna.
                            </p>
                        </div>

                        {/* Globe section */}
                        <div className="rounded-2xl p-6 md:p-8 mb-8 glass-card">
                            <h2
                                className="font-bold mb-5"
                                style={{ fontSize: '1.4rem', color: '#e2e8f0' }}
                            >
                                Interaktiv jordglob
                            </h2>

                            <div ref={containerRef} id="canvas-container">

                                {/* Info panel */}
                                <div className="info-panel">
                                    <h3
                                        className="font-bold mb-3"
                                        style={{ color: '#38bdf8', fontSize: '1rem', letterSpacing: '0.02em' }}
                                    >
                                        Matning
                                    </h3>
                                    {gravity ? (
                                        <>
                                            <div className="mb-3">
                                                <p style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '2px' }}>Latitud</p>
                                                <p style={{ fontSize: '1.25rem', fontWeight: '700', color: '#38bdf8' }}>{clickedPoint.latitude}°</p>
                                            </div>
                                            <div className="mb-3">
                                                <p style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '2px' }}>Longitud</p>
                                                <p style={{ fontSize: '1.25rem', fontWeight: '700', color: '#38bdf8' }}>{clickedPoint.longitude}°</p>
                                            </div>
                                            <hr className="panel-divider" />
                                            <div>
                                                <p style={{ fontSize: '0.75rem', color: '#64748b', marginBottom: '4px' }}>Tyngdfaktor (<em>g</em>)</p>
                                                <p style={{ fontSize: '1.4rem', fontWeight: '700', color: '#facc15', textShadow: '0 0 12px rgba(250, 204, 21, 0.4)' }}>
                                                    <em>g</em> = {gravity} m/s²
                                                </p>
                                            </div>
                                        </>
                                    ) : (
                                        <p style={{ color: '#64748b', fontSize: '0.85rem' }}>
                                            Klicka på jordklotet för att mata <em>g</em>-värdet
                                        </p>
                                    )}
                                    <hr className="panel-divider" />
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                        <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
                                            <input
                                                type="checkbox"
                                                checked={showEquator}
                                                onChange={(e) => setShowEquator(e.target.checked)}
                                                className="dark-checkbox"
                                                aria-label="Visa ekvatorn"
                                            />
                                            <span style={{ fontSize: '0.85rem', color: '#94a3b8' }}>Visa ekvatorn</span>
                                        </label>
                                        <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
                                            <input
                                                type="checkbox"
                                                checked={showPoles}
                                                onChange={(e) => setShowPoles(e.target.checked)}
                                                className="dark-checkbox"
                                                aria-label="Visa polerna"
                                            />
                                            <span style={{ fontSize: '0.85rem', color: '#94a3b8' }}>Visa polerna</span>
                                        </label>
                                    </div>
                                </div>

                                {/* Instruction panel */}
                                <div className="instruction-panel">
                                    <h3
                                        className="font-bold mb-2"
                                        style={{ fontSize: '0.85rem', color: '#38bdf8' }}
                                    >
                                        Instruktioner
                                    </h3>
                                    <ul style={{ fontSize: '0.82rem', color: '#94a3b8', display: 'flex', flexDirection: 'column', gap: '4px', listStyle: 'none', padding: 0, margin: 0 }}>
                                        <li style={{ display: 'flex', gap: '6px' }}><span style={{ color: '#38bdf8' }}>•</span> Dra för att rotera jorden</li>
                                        <li style={{ display: 'flex', gap: '6px' }}><span style={{ color: '#38bdf8' }}>•</span> Scrolla för att zooma in/ut</li>
                                        <li style={{ display: 'flex', gap: '6px' }}><span style={{ color: '#38bdf8' }}>•</span> Klicka för att mata <em>g</em>-värdet</li>
                                        <li style={{ display: 'flex', gap: '6px' }}><span style={{ color: '#ff66ff' }}>•</span> Rosa kryss visar vald plats</li>
                                    </ul>
                                </div>

                            </div>
                        </div>

                        {/* Explanation section */}
                        <div className="rounded-2xl p-6 md:p-8 mb-8 glass-card">
                            <h2
                                className="font-bold mb-5"
                                style={{ fontSize: '1.4rem', color: '#e2e8f0' }}
                            >
                                Varför varierar <em>g</em>?
                            </h2>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1.25rem' }}>

                                <div>
                                    <h3
                                        className="font-bold mb-2"
                                        style={{ fontSize: '1.05rem', color: '#7dd3fc' }}
                                    >
                                        1. Jordens rotation
                                    </h3>
                                    <p style={{ color: '#94a3b8', lineHeight: '1.7' }}>
                                        Vid ekvatorn roterar jorden snabbast, vilket skapar en centrifugalkraft som motverkar
                                        gravitationen. Detta gör att <em>g</em> blir lägre där.
                                    </p>
                                </div>

                                <div>
                                    <h3
                                        className="font-bold mb-2"
                                        style={{ fontSize: '1.05rem', color: '#7dd3fc' }}
                                    >
                                        2. Jordens form
                                    </h3>
                                    <p style={{ color: '#94a3b8', lineHeight: '1.7' }}>
                                        Jorden är inte perfekt sfärisk utan något tillplattad vid polerna. Vid ekvatorn är
                                        du längre från jordens centrum, vilket också bidrar till ett lägre <em>g</em>-värde.
                                    </p>
                                </div>

                                <div
                                    className="rounded-xl p-5"
                                    style={{
                                        background: 'rgba(14, 165, 233, 0.08)',
                                        border: '1px solid rgba(56, 189, 248, 0.2)'
                                    }}
                                >
                                    <h3
                                        className="font-bold mb-2"
                                        style={{ fontSize: '1.05rem', color: '#38bdf8' }}
                                    >
                                        Intressant fakta
                                    </h3>
                                    <p style={{ color: '#94a3b8', lineHeight: '1.7' }}>
                                        Om du väger 70 kg i Stockholm (<em>g</em> ≈ 9,82 m/s²) skulle du väga cirka 250 gram mindre
                                        vid ekvatorn (<em>g</em> ≈ 9,78 m/s²)!
                                    </p>
                                </div>

                            </div>
                        </div>

                    </div>

                    {/* Footer */}
                    <footer className="footer">
                        <p style={{ color: '#64748b', fontSize: '0.9rem' }}>
                            Fysiklabbet &mdash; Interaktiva simuleringar för gymnasiefysik
                        </p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GravitySimulation />);
    </script>
</body>
</html>
