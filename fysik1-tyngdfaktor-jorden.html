<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tyngdfaktorn p√• jorden - Fysiklabbet</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow-x: hidden;
        }
        #canvas-container {
            width: 100%;
            height: 600px;
            position: relative;
            background: linear-gradient(to bottom, #000428, #004e92);
            border-radius: 12px;
            overflow: hidden;
        }
        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            min-width: 200px;
        }
        .instruction-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            max-width: 300px;
        }
        canvas {
            cursor: grab;
        }
        canvas:active {
            cursor: grabbing;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">‚öõÔ∏è</span>
                <span class="logo-text">Fysiklabbet</span>
            </a>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Hem</a></li>
                <li><a href="fysik1.html" class="nav-link active">Fysik 1</a></li>
                <li><a href="fysik2.html" class="nav-link">Fysik 2</a></li>
            </ul>
        </div>
    </nav>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function GravitySimulation() {
            const containerRef = useRef(null);
            const [clickedPoint, setClickedPoint] = useState(null);
            const [gravity, setGravity] = useState(null);
            const [showEquator, setShowEquator] = useState(true);
            const [showPoles, setShowPoles] = useState(true);
            const sceneRef = useRef(null);
            const equatorLineRef = useRef(null);
            const polesRef = useRef(null);

            useEffect(() => {
                if (!containerRef.current) return;

                // Wait for DOM to be fully rendered
                requestAnimationFrame(() => {
                    if (!containerRef.current) return;

                    // Scene setup
                    const scene = new THREE.Scene();
                    sceneRef.current = scene;

                    const camera = new THREE.PerspectiveCamera(
                        75,
                        containerRef.current.clientWidth / containerRef.current.clientHeight,
                        0.1,
                        1000
                    );
                    camera.position.set(0, 0, 3);
                    camera.lookAt(0, 0, 0);

                    const renderer = new THREE.WebGLRenderer({ antialias: true });
                    renderer.setSize(containerRef.current.clientWidth, containerRef.current.clientHeight);
                    containerRef.current.appendChild(renderer.domElement);

                    // Add stars
                    const starsGeometry = new THREE.BufferGeometry();
                    const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.02 });
                    const starsVertices = [];
                    for (let i = 0; i < 1000; i++) {
                        const x = (Math.random() - 0.5) * 50;
                        const y = (Math.random() - 0.5) * 50;
                        const z = (Math.random() - 0.5) * 50;
                        starsVertices.push(x, y, z);
                    }
                    starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
                    const stars = new THREE.Points(starsGeometry, starsMaterial);
                    scene.add(stars);

                    // Earth sphere
                    const geometry = new THREE.SphereGeometry(1, 64, 64);

                    // Create texture loader
                    const textureLoader = new THREE.TextureLoader();

                    // Load Earth texture
                    const earthTexture = textureLoader.load(
                        'https://unpkg.com/three-globe@2.24.9/example/img/earth-blue-marble.jpg',
                        () => {
                            renderer.render(scene, camera);
                        }
                    );

                    const material = new THREE.MeshPhongMaterial({
                        map: earthTexture,
                        shininess: 5
                    });

                    const earth = new THREE.Mesh(geometry, material);
                    earth.position.set(0, 0, 0);
                    // Rotate to show Europe/Africa in center
                    earth.rotation.y = Math.PI;

                    // Equator line (add to earth before adding earth to scene)
                    const equatorPoints = [];
                    const equatorSegments = 128;
                    const equatorRadius = 1.01; // Slightly larger than Earth radius
                    for (let i = 0; i <= equatorSegments; i++) {
                        const angle = (i / equatorSegments) * Math.PI * 2;
                        equatorPoints.push(new THREE.Vector3(
                            Math.cos(angle) * equatorRadius,
                            0,
                            Math.sin(angle) * equatorRadius
                        ));
                    }
                    const equatorGeometry = new THREE.BufferGeometry().setFromPoints(equatorPoints);
                    const equatorMaterial = new THREE.LineBasicMaterial({
                        color: 0xffff00,
                        linewidth: 2,
                        transparent: true,
                        opacity: 0.8
                    });
                    const equatorLine = new THREE.LineLoop(equatorGeometry, equatorMaterial);
                    equatorLineRef.current = equatorLine;
                    earth.add(equatorLine); // Add to earth instead of scene

                    // Pole markers
                    const polesGroup = new THREE.Group();

                    // North pole marker (yellow sphere)
                    const northPoleGeometry = new THREE.SphereGeometry(0.04, 16, 16);
                    const poleMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
                    const northPole = new THREE.Mesh(northPoleGeometry, poleMaterial);
                    northPole.position.set(0, 1.01, 0);
                    polesGroup.add(northPole);

                    // South pole marker (yellow sphere)
                    const southPole = new THREE.Mesh(northPoleGeometry, poleMaterial);
                    southPole.position.set(0, -1.01, 0);
                    polesGroup.add(southPole);

                    polesRef.current = polesGroup;
                    earth.add(polesGroup);

                    scene.add(earth);

                    // Lighting
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
                    scene.add(ambientLight);

                    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    directionalLight.position.set(5, 3, 5);
                    scene.add(directionalLight);

                    // Marker for clicked point
                    let marker = null;

                    // Mouse controls
                    let isDragging = false;
                    let previousMousePosition = { x: 0, y: 0 };

                    const onMouseDown = (e) => {
                        isDragging = true;
                        previousMousePosition = { x: e.clientX, y: e.clientY };
                    };

                    const onMouseMove = (e) => {
                        if (isDragging) {
                            const deltaX = e.clientX - previousMousePosition.x;
                            const deltaY = e.clientY - previousMousePosition.y;

                            earth.rotation.y += deltaX * 0.005;
                            earth.rotation.x += deltaY * 0.005;

                            previousMousePosition = { x: e.clientX, y: e.clientY };
                        }
                    };

                    const onMouseUp = () => {
                        isDragging = false;
                    };

                    const onWheel = (e) => {
                        e.preventDefault();

                        // Zoom in/out by adjusting camera position
                        const zoomSpeed = 0.1;
                        const delta = e.deltaY > 0 ? 1 : -1;

                        camera.position.z += delta * zoomSpeed;

                        // Limit zoom range (min 1.5, max 5)
                        camera.position.z = Math.max(1.5, Math.min(5, camera.position.z));
                    };

                    const onClick = (e) => {
                        if (isDragging) return;

                        const rect = renderer.domElement.getBoundingClientRect();
                        const mouse = new THREE.Vector2();
                        mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
                        mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

                        const raycaster = new THREE.Raycaster();
                        raycaster.setFromCamera(mouse, camera);

                        const intersects = raycaster.intersectObject(earth);

                        if (intersects.length > 0) {
                            const point = intersects[0].point;

                            // Convert world coordinates to earth's local coordinates
                            const localPoint = earth.worldToLocal(point.clone());

                            // Calculate latitude from the local point
                            const radius = 1;
                            const latitude = Math.asin(localPoint.y / radius) * (180 / Math.PI);

                            // Calculate gravity based on latitude
                            // Formula: g = 9.78 + 0.05 * sin¬≤(œÜ)
                            // Equator (0¬∞): 9.78 m/s¬≤, Poles (¬±90¬∞): 9.83 m/s¬≤
                            const latRad = latitude * (Math.PI / 180);
                            const g = 9.78 + 0.05 * Math.pow(Math.sin(latRad), 2);

                            setGravity(g.toFixed(2).replace('.', ','));
                            setClickedPoint({
                                latitude: latitude.toFixed(1).replace('.', ','),
                                longitude: (Math.atan2(localPoint.x, localPoint.z) * (180 / Math.PI)).toFixed(1).replace('.', ',')
                            });

                            // Remove old marker
                            if (marker) {
                                scene.remove(marker);
                            }

                            // Add new marker (yellow X-cross using boxes)
                            const markerGroup = new THREE.Group();
                            const markerMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
                            const markerSize = 0.045;
                            const thickness = 0.01;

                            // First diagonal bar
                            const bar1Geometry = new THREE.BoxGeometry(markerSize, thickness, thickness);
                            const bar1 = new THREE.Mesh(bar1Geometry, markerMaterial);
                            bar1.rotation.z = Math.PI / 4; // 45 degrees
                            markerGroup.add(bar1);

                            // Second diagonal bar
                            const bar2Geometry = new THREE.BoxGeometry(markerSize, thickness, thickness);
                            const bar2 = new THREE.Mesh(bar2Geometry, markerMaterial);
                            bar2.rotation.z = -Math.PI / 4; // -45 degrees
                            markerGroup.add(bar2);

                            // Position and orient the marker to face outward from earth
                            markerGroup.position.copy(point);
                            markerGroup.lookAt(camera.position);

                            marker = markerGroup;
                            scene.add(marker);
                        }
                    };

                    renderer.domElement.addEventListener('mousedown', onMouseDown);
                    renderer.domElement.addEventListener('mousemove', onMouseMove);
                    renderer.domElement.addEventListener('mouseup', onMouseUp);
                    renderer.domElement.addEventListener('click', onClick);
                    renderer.domElement.addEventListener('wheel', onWheel);

                    // Animation loop
                    const animate = () => {
                        requestAnimationFrame(animate);
                        renderer.render(scene, camera);
                    };
                    animate();

                    // Handle resize
                    const handleResize = () => {
                        camera.aspect = containerRef.current.clientWidth / containerRef.current.clientHeight;
                        camera.updateProjectionMatrix();
                        renderer.setSize(containerRef.current.clientWidth, containerRef.current.clientHeight);
                    };
                    window.addEventListener('resize', handleResize);

                    // Cleanup
                    return () => {
                        window.removeEventListener('resize', handleResize);
                        renderer.domElement.removeEventListener('mousedown', onMouseDown);
                        renderer.domElement.removeEventListener('mousemove', onMouseMove);
                        renderer.domElement.removeEventListener('mouseup', onMouseUp);
                        renderer.domElement.removeEventListener('click', onClick);
                        renderer.domElement.removeEventListener('wheel', onWheel);
                        containerRef.current?.removeChild(renderer.domElement);
                    };
                });
            }, []);

            // Toggle equator visibility
            useEffect(() => {
                if (equatorLineRef.current) {
                    equatorLineRef.current.visible = showEquator;
                }
            }, [showEquator]);

            // Toggle poles visibility
            useEffect(() => {
                if (polesRef.current) {
                    polesRef.current.visible = showPoles;
                }
            }, [showPoles]);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4" style={{ marginTop: '80px' }}>
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-xl shadow-lg p-8 mb-8">
                            <h1 className="text-4xl font-bold text-gray-800 mb-4">
                                Tyngdfaktorn p√• jorden
                            </h1>
                            <p className="text-gray-600 text-lg">
                                Tyngdaccelerationen (g) varierar p√• jorden beroende p√• var du befinner dig.
                                Vid ekvatorn √§r den l√§gst (cirka 9,78 m/s¬≤) och vid polerna h√∂gst (cirka 9,83 m/s¬≤).
                                Detta beror p√• jordens rotation och att jorden √§r n√•got tillplattad vid polerna.
                            </p>
                        </div>

                        <div className="bg-white rounded-xl shadow-lg p-8 mb-8">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">Interaktiv jordglob</h2>

                            <div ref={containerRef} id="canvas-container">
                                <div className="info-panel">
                                    <h3 className="text-lg font-bold text-gray-800 mb-3">M√§tning</h3>
                                    {gravity ? (
                                        <>
                                            <div className="mb-3">
                                                <p className="text-sm text-gray-600">Latitud</p>
                                                <p className="text-xl font-bold text-blue-600">{clickedPoint.latitude}¬∞</p>
                                            </div>
                                            <div className="mb-3">
                                                <p className="text-sm text-gray-600">Longitud</p>
                                                <p className="text-xl font-bold text-blue-600">{clickedPoint.longitude}¬∞</p>
                                            </div>
                                            <div className="border-t pt-3">
                                                <p className="text-sm text-gray-600">Tyngdfaktor</p>
                                                <p className="text-2xl font-bold text-red-600">{gravity} m/s¬≤</p>
                                            </div>
                                        </>
                                    ) : (
                                        <p className="text-gray-500 text-sm">Klicka p√• jordklotet f√∂r att m√§ta g-v√§rdet</p>
                                    )}
                                    <div className="border-t mt-3 pt-3">
                                        <label className="flex items-center cursor-pointer mb-2">
                                            <input
                                                type="checkbox"
                                                checked={showEquator}
                                                onChange={(e) => setShowEquator(e.target.checked)}
                                                className="mr-2"
                                            />
                                            <span className="text-sm text-gray-700">Visa ekvatorn</span>
                                        </label>
                                        <label className="flex items-center cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={showPoles}
                                                onChange={(e) => setShowPoles(e.target.checked)}
                                                className="mr-2"
                                            />
                                            <span className="text-sm text-gray-700">Visa polerna</span>
                                        </label>
                                    </div>
                                </div>

                                <div className="instruction-panel">
                                    <h3 className="text-sm font-bold text-gray-800 mb-2">üìç Instruktioner</h3>
                                    <ul className="text-sm text-gray-600 space-y-1">
                                        <li>‚Ä¢ Dra f√∂r att rotera jorden</li>
                                        <li>‚Ä¢ Scrolla f√∂r att zooma in/ut</li>
                                        <li>‚Ä¢ Klicka f√∂r att m√§ta g-v√§rdet</li>
                                        <li>‚Ä¢ Gult kryss visar vald plats</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-lg p-8">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">Varf√∂r varierar g?</h2>
                            <div className="space-y-4 text-gray-700">
                                <div>
                                    <h3 className="font-bold text-lg mb-2">1. Jordens rotation</h3>
                                    <p>
                                        Vid ekvatorn roterar jorden snabbast, vilket skapar en centrifugalkraft som motverkar
                                        gravitationen. Detta g√∂r att g blir l√§gre d√§r.
                                    </p>
                                </div>
                                <div>
                                    <h3 className="font-bold text-lg mb-2">2. Jordens form</h3>
                                    <p>
                                        Jorden √§r inte perfekt sf√§risk utan n√•got tillplattad vid polerna. Vid ekvatorn √§r
                                        du l√§ngre fr√•n jordens centrum, vilket ocks√• bidrar till ett l√§gre g-v√§rde.
                                    </p>
                                </div>
                                <div>
                                    <h3 className="font-bold text-lg mb-2">3. Formeln</h3>
                                    <p className="font-mono bg-gray-100 p-3 rounded">
                                        g = 9,78 + 0,05 √ó sin¬≤(œÜ)
                                    </p>
                                    <p className="mt-2 text-sm">
                                        d√§r œÜ √§r latituden i grader
                                    </p>
                                </div>
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <h3 className="font-bold text-lg mb-2">üí° Intressant fakta</h3>
                                    <p>
                                        Om du v√§ger 70 kg i Stockholm (g ‚âà 9,82 m/s¬≤) skulle du v√§ga cirka 250 gram mindre
                                        vid ekvatorn (g ‚âà 9,78 m/s¬≤)!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GravitySimulation />);
    </script>
</body>
</html>
